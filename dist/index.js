var oe=Object.defineProperty;var le=(i,s,e)=>s in i?oe(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var a=(i,s,e)=>le(i,typeof s!="symbol"?s+"":s,e);var v={headMatch:(i,s)=>i.slice(0,s.length)===s,lastMatch:(i,s)=>i.slice(s.length*-1)===s,byteLength:i=>{let s=i.length;for(let e=i.length-1;e>=0;e--){let t=i.charCodeAt(e);t>127&&t<=2047?s++:t>2047&&t<=65535&&(s+=2),t>=56320&&t<=57343&&e--}return s},replaceVar:({start:i,end:s,text:e,vars:t,defaultVar:r})=>{let n=!1,o="",l="",c=i[0],u=s[0];for(let m=0;m<e.length;m++){let h=e[m];if(n){if(h===u&&e.slice(m,m+s.length)===s){m+=s.length-1;let d=t?t[l.trim()]?.toString():null;d?o+=d:r&&(o+=r),l="",n=!1;continue}l+=h}else{if(h===c&&(n=e.slice(m,m+i.length)===i,n)){m+=i.length-1;continue}o+=e[m]}}return n?o+i+l:o},format:(i,s,e="-")=>{let t=0,r="";for(let n=0;n<i.length;n++)i[n]==="v"?(r+=s[t]==null?e:s[t],t+=1):r+=i[n];return r},findMatchOrLast:(i,s)=>{for(let e of s)if(i===e)return e;return s[s.length-1]||null},pickInTagContents:i=>{let s=[],{text:e,start:t,end:r}=i;if(!t||!r)return s;let n=e.length,o=t.length,l=r.length,c=(T,d,y)=>{if(d+y.length>T.length)return!1;for(let X=0;X<y.length;X++)if(T[d+X]!==y[X])return!1;return!0},u=0,m="",h=!1;for(;u<n;)if(h){if(c(e,u,r)){s.push(m),u+=l,h=!1;continue}m+=e[u],u++}else{if(c(e,u,t)){u+=o,h=!0,m="";continue}u++}return s},removeInTagContents(i){let{text:s,start:e,end:t}=i;if(!e||!t)return s;let r=s.length,n=e.length,o=t.length,l=(h,T,d)=>{if(T+d.length>h.length)return!1;for(let y=0;y<d.length;y++)if(h[T+y]!==d[y])return!1;return!0},c="",u=0,m=!1;for(;u<r;)if(m){if(l(s,u,t)){m=!1,u+=o;continue}u++}else{if(l(s,u,e)){m=!0,u+=n;continue}c+=s[u],u++}return c}};var M={jpjs:(i,s)=>JSON.parse(JSON.stringify(i,s)),nonStrictJSONParse:i=>{try{return typeof i=="string"?JSON.parse(i):i}catch{return{}}},nonStrictJSONStringify:i=>{try{return JSON.stringify(i)}catch{return"{}"}}};var g={run:i=>i(),sleep:i=>new Promise(s=>{setTimeout(()=>s(null),i)}),randomInt:(i,s)=>Math.floor(Math.random()*(s-i+1)+i),createUuid:()=>{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let i=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=(i+Math.random()*16)%16|0;return i=Math.floor(i/16),(s==="x"?e:e&3|8).toString(16)})},createWithTsUuid:()=>`${Date.now()}-${g.createUuid()}`,retry:async i=>{let s=0,e=i.max==null?1:i.max,t=[];for(;e>0;){try{return await i.action(s)}catch(r){i.onFail&&i.onFail(s,r),t.push({count:s,error:r})}s+=1,e-=1,i.interval&&await g.sleep(i.interval)}throw t},asyncWhile:async i=>{let s=!1,e={count:0,doBreak:()=>{s=!0}};for(;await i(e),!s;)e.count+=1},waitFor:i=>new Promise((s,e)=>{let t={done:!1},r=l=>{t.done=!0,s(l)},n=l=>{t.done=!0,e(l)},o=async()=>{try{await i.handler(r,n)}catch(l){n(l)}t.done||setTimeout(o,i.interval)};o()})};var f={ifBad:(i,s)=>{let e=f.getType(i);return["empty","NaN","error"].includes(e)?s:i},ifEmpty:(i,s)=>i??s,getType:i=>{let s=typeof i;return i==null?"empty":Array.isArray(i)?"array":s==="number"&&isNaN(i)?"NaN":i instanceof RegExp?"regexp":i instanceof Promise?"promise":typeof Buffer<"u"&&Buffer.isBuffer(i)?"buffer":i instanceof Error?"error":s},peel:(i,s)=>{let e=s.split(/[.[\]'"]/g).filter(r=>r.trim()!==""),t=i;for(;;){if(e.length===0)return t;if(f.getType(t)!=="object")return null;let r=e.shift();r&&(t=t[r])}},vars:({start:i,end:s,text:e})=>{let t=!1,r=[],n="",o=i[0],l=s[0];for(let c=0;c<e.length;c++){let u=e[c];if(t){if(u===l&&e.slice(c,c+s.length)===s){c+=s.length-1,r.push(n),n="",t=!1;continue}n+=u}else if(u===o&&(t=e.slice(c,c+i.length)===i,t)){c+=i.length-1;continue}}return r}};var ee={toMs:(i,s)=>{let e=0;return i==="s"&&(e=s*1e3),i==="m"&&(e=s*6e4),i==="h"&&(e=s*36e5),i==="d"&&(e=s*864e5),i==="y"&&(e=s*315576e5),Math.floor(e)}};var Z={groups:(i,s)=>{let e=[];for(let t=0;t<s.length;t+=i)e.push(s.slice(t,t+i));return e},randomPick:i=>i[Math.floor(Math.random()*i.length)],randomPicks:(i,s)=>{if(s.length<=i)return s.slice();let e=[],t=s.length*100;for(;t>0&&!(e.length>=i);){t-=1;let r=Z.randomPick(s);e.includes(r)===!1&&e.push(r)}return e},unique:i=>[...new Set(i)],asyncMap:async(i,s)=>{let e=[];for(let t of i){let r=await s(t);e.push(r)}return e},check:(i,s)=>i.includes(s)?i.filter(e=>e!==s):[...i,s]};var x={setMapValue:(i,s,e)=>{let t=(r,n,o="")=>{let l={},c=r==null?{}:M.jpjs(r),u=n==null?{}:M.jpjs(n);for(let m in c){if(f.getType(c[m])==="object"&&(!!e&&!!e.directReplacePeels&&e.directReplacePeels.includes(`${o}${m}`))===!1){l[m]=t(c[m],u[m],`${o}${m}.`);continue}u[m]===void 0?l[m]=c[m]:l[m]=u[m]}return l};return t(i,s)},createStrictObject:i=>{let s={},e=(t,r)=>new Error(`Strict Object Fail - ${t}: ${r}!`);for(let t in i){let[r,n,o,l]=i[t],c=f.getType(o),u=o;if(c==="empty"){if(n)throw e(t,"is required")}else{if(r===String){if(c!=="string")throw e(t,"not a string");if(n&&u.trim()==="")throw e(t,"no content")}if(r===Number){if(c!=="number"&&c!=="string")throw e(t,"not a number");if(c==="string"&&(u=Number(u.trim())),isNaN(u))throw e(t,"is NaN")}if(r===Boolean){if(c==="string"){if(u=u.trim(),u!=="true"&&u!=="false")throw e(t,"not a boolean");u=u==="true"}if(u!==!0&&u!==!1)throw e(t,"output value not a true or false")}}s[t]=c==="empty"?l:u}return Object.freeze(s)},omit:(i,s)=>{let e={};for(let t in i)s.includes(t)===!1&&(e[t]=i[t]);return e},promiseAllWithKeys:i=>{let s=Object.keys(i),e=Object.values(i);return Promise.all(e).then(t=>t.reduce((r,n,o)=>(r[s[o]]=n,r),{}))},simpleCheckDeepDiff:(i,s)=>{let e=f.getType(i),t=f.getType(s);if(e!==t)return!0;if(e==="object"){let r=Object.keys(i),n=Object.keys(s);if(r.length!==n.length)return!0;for(let o of r)if(x.simpleCheckDeepDiff(i[o],s[o]))return!0;return!1}if(e==="array"){if(i.length!==s.length)return!0;for(let r=0;r<i.length;r++)if(x.simpleCheckDeepDiff(i[r],s[r]))return!0;return!1}return i!==s}};var Y=()=>typeof window>"u"?null:window.navigator,K={inAppBrowser:()=>{let i=Y();if(i==null)return!1;let s=i.userAgent.toLowerCase(),e=["line/","instagram","fbios","fb_iab","fban","fbav","micromessenger"];for(let t of e)if(s.includes(t))return!0;return!1},inMobile:()=>K.inIOS()||K.inAndroid(),inIOS:()=>{let i=Y();return i==null?!1:/iPad|iPhone|iPod/.test(i.userAgent)},inAndroid:()=>{let i=Y();return i==null?!1:i.userAgent.toLowerCase().indexOf("android")>-1},inSafari:()=>{let i=Y();if(i==null)return!1;let s=i.userAgent,e=!!s.match(/iP(ad|od|hone)/i),t=!!s.match(/Safari/i),r=!s.match(/Chrome|CriOS|OPiOS|mercury|FxiOS|Firefox/i),n=!1;return e?n=!!s.match(/WebKit/i)&&t&&r:typeof window<"u"&&window.safari!==void 0?n=!0:n=t&&r,n}};var te={inputAccept:(i,s,e)=>{if(i==="*/*")return!0;let t=[];if(i.split(",").forEach(r=>{(r===".jpg"||r===".jpeg")&&(t.push(/image\/(jpeg)/i),t.push(/image\/(jpg)/i)),r===".mp3"&&(t.push(/audio\/(mpeg)/i),t.push(/audio\/(mp3)/i)),r.indexOf("/*")!==-1&&t.push(new RegExp(r.replace("*",".+"),"i")),r.startsWith(".")&&t.push(new RegExp(`\\${r}$`,"i")),t.push(new RegExp(r.replace("/","\\/"),"i"))}),e){if(!t.some(n=>n.test(s)||n.test(e)))return!1}else if(!t.some(n=>n.test(s)))return!1;return!0}};var se={importScript:(i,s)=>new Promise((e,t)=>{let r=window.document,n=r.createElement("script"),o=Array.from(window.document.getElementsByTagName("script"));for(let l of o)if(l.src===i)return e(null);n.src=i,s?.appendBefore&&s.appendBefore(n),n.onload=e,n.onerror=t,r.body.appendChild(n)}),createAndAppend:(i,s,e)=>{let t=window.document.createElement(i);return s(t),e?e.appendChild(t):window.document.body.appendChild(t),t},importCss:(i,s)=>new Promise((e,t)=>{let r=window.document,n=r.createElement("link"),o=Array.from(window.document.getElementsByTagName("link"));for(let l of o)if(l.href===i)return e(null);n.rel="stylesheet",n.href=i,s?.appendBefore&&s.appendBefore(n),n.onload=e,n.onerror=t,r.body.appendChild(n)})};var re=class{constructor(s,e,t){a(this,"id",Date.now().toString()+Math.floor(Math.random()*1e6));a(this,"state",{});a(this,"event");a(this,"callback");a(this,"manager");this.manager=s,this.event=e,this.callback=t}invoke(s){this.callback(s,{id:this.id,off:()=>this.off(),state:this.state})}off(){this.manager.off(this.event,this.id)}},p=class{constructor(){a(this,"listeners",new Map)}getEventListenerSize(s){let e=this.listeners.get(s);return e?e.length:0}emit(s,e){let t=this.listeners.get(s);if(t)for(let n of t)n.invoke(e);let r=this.listeners.get("*");if(r)for(let n of r)n.invoke({data:e,event:s})}off(s,e){let t=s,r=this.listeners.get(t);r&&this.listeners.set(t,r.filter(n=>n.id!==e))}on(s,e){let t=s,r=new re(this,t,e);return this.listeners.has(t)===!1&&this.listeners.set(t,[]),this.listeners.get(t).push(r),r}};var ce={default:"",red:"\x1B[31m",blue:"\x1B[34m",cyan:"\x1B[36m",black:"\x1B[30m",white:"\x1B[37m",green:"\x1B[32m",yellow:"\x1B[33m"},_=class extends p{constructor(e,t){super();a(this,"step",0);a(this,"name");a(this,"isSilence",!1);a(this,"defaultLogType","normal");this.name=e,t&&(t.silence!=null&&this.silence(t.silence),t.defaultLogType!=null&&(this.defaultLogType=t.defaultLogType))}getNow(){return new Date().toISOString().split(/T|\./).slice(0,2).join(" ")}toPrintString(e,t,r){return`[${e}][${this.name}][${t}] ${this.step}: ${r}`}silence(e=!0){this.isSilence=e}print(e,t={}){this.step+=1;let r=this.getNow(),n=t.color||"default",o=t.logType||this.defaultLogType,l=this.toPrintString(r,o,e),c={time:r,name:this.name,step:this.step,data:e,color:n,message:l,logType:o,silence:this.isSilence};return this.emit("print",c),this.isSilence===!1&&(n==="default"?console.log(l):typeof window>"u"?console.log(`${ce[n]}${l}\x1B[0m`):console.log(`%c ${l}`,`color: ${n}`)),c}};var{replaceVar:ue}=v,R=class extends p{constructor(e){super();a(this,"params");a(this,"nowLocale");this.params=e,this.nowLocale=e.def}get(e,t,...r){let n=t;n.slice(0,2)==="##"?n=n.slice(2).trim():n=this.params.locales?.[e]?.[t]||t;let o=ue({start:"{",end:"}",text:n,vars:r[0]||{}});return this.emit("get",{key:t,text:n,locale:e,output:o}),o}export(e){return(t,...r)=>this.get(e,t,...r)}t(e,...t){return this.get(this.nowLocale,e,...t)}setLocale(e){this.nowLocale=e}getLocale(){return this.nowLocale}key(e,...t){return{get:r=>this.get(r,e,...t)}}};var ie=class{constructor(s,e,t){a(this,"id",Date.now().toString()+Math.floor(Math.random()*1e6));a(this,"state",{});a(this,"channel");a(this,"callback");a(this,"manager");a(this,"isAfter",!1);this.manager=s,this.channel=e,this.callback=t}async invoke(s){await this.callback(s,{id:this.id,off:()=>this.off(),state:this.state})}off(){this.manager.detach(this.channel,this.id)}},I=class{constructor(){a(this,"listeners",new Map)}async notify(s,e){let t=this.listeners.get(s);if(t){for(let r of t.filter(n=>n.isAfter===!1))await r.invoke(e);for(let r of t.filter(n=>n.isAfter))await r.invoke(e)}}detach(s,e){let t=s,r=this.listeners.get(t);r&&this.listeners.set(t,r.filter(n=>n.id!==e))}attach(s,e){let t=s,r=new ie(this,t,e);return this.listeners.has(t)===!1&&this.listeners.set(t,[]),this.listeners.get(t).push(r),r}attachAfter(s,e){let t=this.attach(s,e);return t.isAfter=!0,t}};var ne=class{constructor(s,e,t){a(this,"data");a(this,"index");a(this,"ttl");a(this,"createdAt",Date.now());this.data=s,this.index=e,this.ttl=t}isExpired(){return this.createdAt+this.ttl<Date.now()}},k=class extends p{constructor(e){super();a(this,"event",new p);a(this,"key");a(this,"index",0);a(this,"maxSize");a(this,"pick");a(this,"ttl");a(this,"items",new Map);this.key=e.key,this.pick=e.pick,this.maxSize=e.maxSize||1/0,this.ttl=e.ttl==null?1/0:e.ttl}refresh(){if(this.ttl!==1/0&&this.removeExpired(),this.maxSize!==1/0&&this.items.size>this.maxSize){let e=this.items.size-this.maxSize,t=[...this.items.entries()].sort((r,n)=>r[1].index>n[1].index?1:-1).slice(0,e);for(let r of t)this.removeByKey(r[0])}}keys(){return Array.from(this.items.keys())}size(){return this.items.size}clear(){let e=this.keys();for(let t of e)this.removeByKey(t)}remove(e){let t=this.key(e);this.removeByKey(t)}removeExpired(){for(let[e,t]of this.items)t.isExpired()&&this.removeByKey(e)}removeByKey(e){let t=this.items.get(e);t&&(this.emit("remove",{data:t.data}),this.items.delete(e))}set(e,t){let r=this.key(e);this.setByKey(r,t)}setByKey(e,t){this.removeByKey(e),this.index+=1,this.items.set(e,new ne(t,this.index,this.ttl)),this.refresh()}get(e){return this.refresh(),new Promise((t,r)=>{let n=this.key(e),o=this.items.get(n);if(o&&o.isExpired()===!1)return t(o.data);let l=`${n}-onload`,c=`${n}-error`,[u,m]=[this.event.on(l,h=>{u.off(),m.off(),t(h)}),this.event.on(c,h=>{u.off(),m.off(),r(h)})];this.event.getEventListenerSize(l)===1&&this.pick(e,{key:n}).then(h=>{this.event.emit(l,h),this.setByKey(n,h)}).catch(h=>{this.event.emit(c,h)})})}};var b=class extends p{constructor(e,t){super();a(this,"int");a(this,"isStop",!1);a(this,"delta",0);a(this,"previousTime",Date.now());this.int=setInterval(()=>this.run(),e),t&&t.autoPlay===!1&&this.stop()}run(){if(this.isStop===!1){let e=Date.now();this.delta+=1,this.emit("next",{delta:this.delta,timeGap:e-this.previousTime}),this.previousTime=e}}stop(){this.isStop=!0}play(){this.isStop=!1,this.previousTime=Date.now()}close(){clearInterval(this.int)}};var D=class extends b{constructor(){super(1,{autoPlay:!1});a(this,"nowTime",0);a(this,"minTime",0);a(this,"maxTime",999999999999);a(this,"positive",!0);this.on("next",({timeGap:e})=>{this.positive?this.nowTime+=e:this.nowTime-=e,this.nowTime<=this.minTime&&(this.nowTime=this.minTime),this.nowTime>=this.maxTime&&(this.nowTime=this.maxTime)})}setPositive(e){return this.positive=e,this}setMinTime(e){this.minTime=e}setMaxTime(e){this.maxTime=e}getTime(){return this.nowTime}setTime(e){return this.nowTime=e,this}addTime(e){return this.nowTime+=e,this}subtractTime(e){return this.nowTime-=e,this}getHours(){return this.nowTime/1e3/60/60}getMinutes(){return this.nowTime/1e3/60%60}getSeconds(){return this.nowTime/1e3%60}getMicroseconds(){return this.nowTime%1e3}getTimeString(e="hh:mm:ss.ff"){let t=Math.floor(this.getHours()).toString().padStart(2,"0"),r=Math.floor(this.getMinutes()).toString().padStart(2,"0"),n=Math.floor(this.getSeconds()).toString().padStart(2,"0"),o=Math.floor(this.getMicroseconds()/10).toString().padStart(2,"0");return e.replace("hh",t).replace("mm",r).replace("ss",n).replace("ff",o)}};var L=(i,s)=>{throw new Error(`PowerHelper (X_X) => ${i} -> ${s}`)};var j=class extends p{constructor(e="no_name"){super();a(this,"name");a(this,"items",[]);a(this,"status",{isDone:!1,isCalled:!1,isLoading:!1,complete:0,fail:null});this.name=e}get size(){return this.items.length}get complete(){return this.status.complete}get done(){return this.status.isDone}get fail(){return this.status.fail}get called(){return this.status.isCalled}get loading(){return this.status.isLoading}clear(){this.items=[],this.emit("clear",{})}push(e,t){this.items.find(n=>n.name===e)&&L("push",`Loader ${e} push name ${e} already exists.`),this.items.push({name:e,handler:t})}reset(){if(this.status.isDone===!1)throw new Error(`Loader ${this.name} call "reset" must called start.`);return Object.assign(this.status,{isDone:!1,isCalled:!1,isLoading:!1,complete:0,fail:null}),this}start(e){return this.status.isCalled&&L("start",`Loader ${this.name} Already Called.`),this.status.isCalled=!0,this.status.isLoading=!0,this.emit("call",{}),new Promise((t,r)=>{let n=this.items.map(({name:o,handler:l})=>async()=>{try{let c=await l(e);return this.status.complete+=1,this.emit("complete",{name:o,result:c,loaderName:this.name}),{name:o,result:c}}catch(c){throw{isPowerHelperLoader:!0,loaderName:this.name,name:o,error:c}}});Promise.all(n.map(o=>o())).then(o=>{this.status.isDone=!0,this.status.isLoading=!1,this.emit("done",{}),t(o)}).catch(o=>{this.status.isDone=!0,this.status.isLoading=!1,this.status.fail=o,this.emit("fail",{error:o}),r(o)})})}};function pe(i){return i.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`)}var w=class{constructor(){a(this,"styles",{})}set(s,e,t){let r=e??t;r&&(this.styles[s]=r)}get(s){return this.styles[s]}remove(s){this.styles[s]&&delete this.styles[s]}assign(s){for(let[e,t]of Object.entries(this.styles))s.style[e]=t}join(s=";"){let e=[];for(let[t,r]of Object.entries(this.styles))e.push(`${pe(t)}:${r}`);return e.join(s)}};var A=class extends p{constructor(e){super();a(this,"objectUrls",[]);a(this,"params");this.params=e}createObjectUrl(e){let t=URL.createObjectURL(e);return this.objectUrls.push(t),t}get(e,...t){return this.url(this.params.items?.[e]?.(t[0])||"")}url(e){let t="",r=!1;if(typeof e=="string"){let n=e.trim(),o=["http","file","data:","//"];for(let l of o)if(v.headMatch(n,l)){t=n;break}}else typeof File<"u"&&e instanceof File?(t=this.createObjectUrl(e),r=!0):typeof Blob<"u"&&e instanceof Blob?(t=this.createObjectUrl(e),r=!0):typeof MediaSource<"u"&&e instanceof MediaSource&&(t=this.createObjectUrl(e),r=!0);return t.trim()===""&&(t=typeof e=="string"?this.params.def(e):""),this.emit("fetch",{url:t,source:e,isObjectUrl:r}),t}release(){this.objectUrls.forEach(e=>URL.revokeObjectURL(e)),this.objectUrls=[]}backgroundStyle(e,t="basic"){let r=new w;return r.set("backgroundImage",`url(${this.url(e)})`),t==="cover"&&(r.set("backgroundSize","cover"),r.set("backgroundRepeat","no-repeat"),r.set("backgroundPosition","center")),r.join()}};var S=class extends p{constructor(){super(...arguments);a(this,"int",setInterval(()=>this._run(),100));a(this,"isStop",!1);a(this,"lastTime",Date.now());a(this,"processes",[])}_run(){if(this.isStop)return null;let e=Date.now(),t=e-this.lastTime;this.lastTime=e;for(let r of this.processes)r.runningTime||(r.now+=t,r.now>=r.sec&&(r.now=0,r.runningTime=Date.now(),r.executedCount+=1,r.handler().then(()=>{r.runningTime=null}).catch(n=>{r.runningTime=null,this.emit("processFail",{processName:r.name,error:n})})))}run(e){let t=this.processes.find(r=>r.name===e);t!=null&&t.runningTime==null&&(t.now=t.sec,this._run())}add(e,t,r){this.processes.find(n=>n.name===e)&&L("add",`Name ${e} already exists.`),this.processes.push({sec:t,now:0,name:e,executedCount:0,runningTime:null,handler:r})}has(e){return!!this.processes.find(t=>t.name===e)}remove(e){this.processes.find(t=>t.name===e)==null&&L("add",`Name ${e} not found.`),this.processes=this.processes.filter(t=>t.name!==e)}info(){return this.processes.map(e=>({name:e.name,runningTime:e.runningTime,executedCount:e.executedCount}))}stop(){this.isStop=!0}play(){this.isStop=!1}close(){clearInterval(this.int)}};var O=class extends p{constructor(e){super();a(this,"state");a(this,"oldKey",null);a(this,"params");a(this,"schedule",new S);a(this,"installed",!1);a(this,"nextTicks",[]);this.params=e}isActive(){return this.installed}close(){this.schedule.close()}nextTick(e){this.nextTicks.push(e)}async from(e){this.oldKey=null,this.state=e,this.installed=!0;let t=this.params.schedule!=null?this.params.schedule:100;return await this.dispatch(),this.schedule.has("reactive")===!1&&this.schedule.add("reactive",t,async()=>{await this.dispatch()}),this}async dispatch(){let e=await this.params.observable(this.state);if(e!==this.oldKey&&await this.trigger(e),this.nextTicks.length>=1){for(let t of this.nextTicks)t(this.state);this.nextTicks=[]}}async trigger(e){let t={state:this.state,newKey:e,oldKey:this.oldKey};this.emit("actionBefore",t),await this.params.action({...t,close:()=>this.close()}),this.emit("actionAfter",t),this.oldKey=e}};var ae=class extends p{constructor(e){super();a(this,"isDone",!1);a(this,"params");a(this,"values",[]);a(this,"duration");a(this,"totalDuration");this.params=e,this.duration=e.delay==null?-1:e.delay,this.totalDuration=e.totalDuration==null?-1:e.totalDuration,this.loop()}loop(){if(this.isDone)return null;if(this.duration===0)return this.trigger();if(this.totalDuration===0)return this.trigger();if(this.params.maxValueLength!=null&&this.params.maxValueLength<=this.values.length)return this.trigger();this.duration-=1,this.totalDuration-=1,setTimeout(()=>this.loop(),1)}input(e){this.values.push(e),this.duration=this.params.delay==null?-1:this.params.delay}trigger(){this.isDone===!1&&(this.close(),this.emit("trigger",{values:this.values}))}close(){this.isDone===!1&&(this.isDone=!0,this.emit("close",{}))}},$=class extends p{constructor(e){super();a(this,"unit",null);a(this,"params");this.params=e}input(e){this.unit==null&&(this.unit=new ae(this.params),this.unit.on("trigger",({values:t})=>this.emit("trigger",{values:t})),this.unit.on("close",()=>this.close())),this.unit.input(e),this.emit("input",{value:e})}trigger(){this.unit?this.unit.trigger():this.emit("trigger",{values:[]})}close(){this.unit&&(this.unit.close(),this.unit=null)}};var N=class extends p{constructor(e){super();a(this,"jobs",[]);a(this,"closed",!1);a(this,"params");a(this,"isStop",!1);a(this,"runningCount",0);this.params=e,this.params.autoPlay===!1&&(this.isStop=!0)}get size(){return this.jobs.length+this.runningCount}run(){if(this.isStop||this.closed||this.params.concurrentExecutions&&this.runningCount>=this.params.concurrentExecutions)return null;let e=this.jobs.shift();e&&(this.runningCount+=1,e.handler().catch(t=>{this.emit("error",{name:e?.name||"",error:t})}).finally(()=>{this.less(),this.run()}))}less(){this.runningCount-=1,this.runningCount<=0&&(this.runningCount=0),this.size===0&&this.emit("allDone",{})}get isStoped(){return this.isStop}push(e,t){this.closed===!1&&(this.jobs.push({name:e,handler:t}),this.run())}stop(){this.isStop=!0}play(){this.isStop&&(this.isStop=!1,this.run())}pushAndWait(e,t){return new Promise((r,n)=>{if(this.closed)return r(null);this.jobs.push({name:e,handler:async()=>{try{await t(),r(null)}catch(o){n(o)}}}),this.run()})}unshift(e,t){this.closed===!1&&(this.jobs.unshift({name:e,handler:t}),this.run())}clear(){this.jobs=[]}close(){this.clear(),this.closed=!0}};var B=class{constructor(s,e){a(this,"options");a(this,"storage");a(this,"namespaces");a(this,"interceptGet",null);a(this,"interceptSet",null);this.options=e,this.storage=typeof window>"u"?null:window.localStorage,this.namespaces=s,e&&(e.storageSystem&&(this.storage=e.storageSystem),e.intercept&&(e.intercept.get&&(this.interceptGet=e.intercept.get.bind(this)),e.intercept.set&&(this.interceptSet=e.intercept.set.bind(this))))}toKey(s){return`_power_${this.namespaces}/${s.toString()}`}set(s,e){let t=typeof e=="function"?e(this.get(s)):e;this.interceptSet&&(t=this.interceptSet(s,t)),this.storage.setItem(this.toKey(s),JSON.stringify(t))}get(s){let e=null,t=this.options,r=!1,n=()=>null;t&&t.defaultColumns&&t.defaultColumns[s]&&(n=t.defaultColumns[s]);let o=this.storage.getItem(this.toKey(s));return o==null&&(o=n(),r=!0),e=r?o:o!=null?JSON.parse(o):null,this.interceptGet&&(e=this.interceptGet(s,e,{storage:this,isDefault:r,defaultValue:n})),e}clear(){let s=`_power_${this.namespaces}/`,e=this.storage.keys?this.storage.keys():Object.keys(this.storage);for(let t of e)t.length>=s.length&&t.slice(0,s.length)===s&&this.remove(t.slice(s.length))}remove(s){this.storage.removeItem(this.toKey(s))}};var P=class{constructor(s){a(this,"params");a(this,"timeout",null);a(this,"collection",[]);this.params=s}push(s){return new Promise((e,t)=>{this.collection.push({data:s,resolve:e,reject:t}),this.timeout==null&&(this.timeout=setTimeout(async()=>{let r=this.collection.slice();this.timeout=null,this.collection=[];try{let n=await this.params.query(r.map(o=>o.data));r.forEach(o=>o.resolve(n))}catch(n){r.forEach(o=>o.reject(n))}},this.params.waitTime))})}};var V=class{constructor(s){a(this,"elements",[]);a(this,"listeners",new Map);s&&this.elements.push(s)}observe(s){this.elements.push(s);for(let e of this.listeners.values())s.addEventListener(e.name,e.callback,e.options)}unObserve(s){if(this.elements.find(e=>e===s)!=null){this.elements=this.elements.filter(e=>e!==s);for(let e of this.listeners.values())s.removeEventListener(e.name,e.callback)}}off(s){let e=this.listeners.get(s);if(e){this.listeners.delete(s);for(let t of this.elements)t.removeEventListener(e.name,e.callback)}}add(s,e,t){let r=g.createUuid(),n={name:s,options:t,callback:e};return this.listeners.set(r,n),this.elements.forEach(o=>o.addEventListener(n.name,n.callback,t)),{id:r,off:()=>this.off(r)}}clear(){for(let s of this.listeners.keys())this.off(s)}clearElements(){for(let s of this.listeners.values())for(let e of this.elements)e.removeEventListener(s.name,s.callback);this.elements=[]}};var U=class extends p{constructor(e){super();a(this,"_websocket");a(this,"params");a(this,"isManuallyClosed",!1);this.params=e}fail(e,t){this.emit("$error",{from:e,error:t})}get connected(){return!!this._websocket}createWebsocket(e){this.connected&&console.warn(`Websocket ${e} already connected.`);let t=!1,r=this.params.system?this.params.system:WebSocket;return new Promise((n,o)=>{this._websocket=new r(e,this.params.protocol),this._websocket.onopen=()=>{t=!0,this.emit("$open",{}),n(null)},this._websocket.onerror=l=>{t===!1?o(l):this.fail("unknown",l)},this._websocket.onmessage=async l=>{try{await this.params.onMessage(l)}catch(c){this.fail("message",c)}},this._websocket.onclose=()=>{let l={isManuallyClosed:this.isManuallyClosed};this._websocket=void 0,this.emit("$close",l),this.isManuallyClosed=!1}})}getStatus(){if(this.connected===!1)return"wait";if(this._websocket?.readyState===0)return"connecting";if(this._websocket?.readyState===1)return"open";if(this._websocket?.readyState===2)return"closeing";if(this._websocket?.readyState===3)return"closed"}async send(e,t){try{let r=await this.params.sendHandler(e,t);this.connected?this._websocket?.send(r):console.warn(`Socket not connected, from send ${e}.`)}catch(r){this.fail("send",r)}}async connect(){let e=await this.params.url();return await this.createWebsocket(e)}disconnect(){this.connected?(this.isManuallyClosed=!0,this._websocket?.close()):console.warn("Socket not connected, from disconnect.")}};var H=class{constructor(s,e={}){a(this,"pick");a(this,"options");a(this,"processes",[]);this.pick=s,this.options=e}run(s){let e={data:null,closed:!1,reject:null,resolve:null,isError:!1},t=(r,n)=>{if(e.data=r,e.closed=!0,e.isError=n,this.processes.filter(l=>!l.closed).length===0){let l;this.pick==="first"?l=this.processes[0]:l=this.processes[this.processes.length-1];for(let c of this.processes)l.isError?c.reject(l.data):c.resolve(l.data);this.processes=[]}};return this.processes.push(e),new Promise((r,n)=>{e.reject=n,e.resolve=r,setTimeout(()=>{s().then(o=>t(o,!1)).catch(o=>t(o,!0))},this.options.delay||10)})}};var E=class{constructor(s){a(this,"params");a(this,"lastUpdate",Date.now());a(this,"keyMap",new Map);this.params=s}gc(){let s=Date.now();if(s>this.lastUpdate+this.params.ttl){for(let[e,t]of this.keyMap.entries())t.time+this.params.ttl<s&&this.keyMap.delete(e);this.lastUpdate=s}}get size(){return this.keyMap.size}clear(){this.keyMap.clear()}get(s){return this.gc(),this.keyMap.get(s)?.data}set(s,e){let t={key:s,value:e},r=this.params.intercept?.set?this.params.intercept?.set(t):t;if(this.gc(),this.keyMap.set(r.key,{data:r.value,time:Date.now()}),this.params.maxSize&&this.keyMap.size>this.params.maxSize){let n=Array.from(this.keyMap.keys())[0];n!=null&&this.keyMap.delete(n)}return r.value}has(s){return this.gc(),this.keyMap.has(s)}remove(s){this.gc(),this.keyMap.has(s)&&this.keyMap.delete(s)}keys(){return this.gc(),[...this.keyMap.keys()]}values(){return this.gc(),[...this.keyMap.values()].map(s=>s.data)}};var z=class{constructor(s){a(this,"params");this.params=s}static get bootstrapBreakpoints(){return{xs:{min:1/0*-1,max:575},sm:{min:576,max:767},md:{min:768,max:991},lg:{min:992,max:1119},xl:{min:1200,max:1/0}}}static get vuetifyBreakpoints(){return{xs:{min:1/0*-1,max:599},sm:{min:600,max:959},md:{min:960,max:1263},lg:{min:1264,max:1903},xl:{min:1904,max:1/0}}}matchs(s=this.params.defCheckValue()){let e=[];for(let t in this.params.points){let r=t,{min:n,max:o}=this.params.points[r];s>=n&&s<=o&&e.push(`${r}-only`),s>=n&&e.push(`${r}-and-up`),s<=o&&e.push(`${r}-and-down`)}return e}is(s=this.params.defCheckValue()){let e=["xl","lg","md","sm","xs"],t=this.matchs(s);for(let r of e)if(t.includes(`${r}-only`))return r;return"xs"}in(s,e=this.params.defCheckValue()){return this.matchs(e).includes(s)}};var W=class i extends p{constructor(e,t){super();a(this,"serviceName");a(this,"parent",null);a(this,"options",{defaultError:()=>"Error!",parseMessage:e=>e});this.serviceName=e,t&&Object.assign(this.options,t)}static get basicMessageParser(){return e=>{if(typeof e=="string")return e;if(e.name==="AxiosError"){if(e.response?.data&&typeof e.response?.data=="string")return e.response.data;if(e.response?.data?.message&&typeof e.response?.data?.message=="string")return e.response?.data?.message;if(e.response?.data?.error&&typeof e.response?.data?.error=="string")return e.response?.data?.error}let t=e.message;return t&&typeof t=="string"?t:null}}_setParent(e){this.parent=e}_getParents(){return this.parent==null?[]:[this.parent,...this.parent._getParents()]}get fullName(){return this.parent==null?this.serviceName:`${this.parent.fullName}/${this.serviceName}`}parseMessage(e){let t=this.options.parseMessage(e);return t||this.options.defaultError()}create(e){let t=this.parseMessage(e),r={error:e,message:t};return this._getParents().concat([this]).forEach(n=>n.emit("fail",r)),new Error(`${this.fullName}: ${t}`)}checkout(e){let t=new i(e,this.options);return t._setParent(this),t}};var F=class i extends p{constructor({name:e,interceptorMessage:t,stepMaxSize:r}){super();a(this,"name");a(this,"steps",[]);a(this,"parent");a(this,"stepMaxSize",100);a(this,"interceptorMessage");this.name=e,this.interceptorMessage=t||(n=>n),this.stepMaxSize=r||100}get fullName(){return this.parent?`${this.parent.fullName}/${this.name}`:this.name}pushStep(e){if(this.parent)this.parent.pushStep(e);else{this.steps.length>=this.stepMaxSize&&this.steps.shift();let t={...e,message:this.interceptorMessage(e.message),createdAt:Date.now()};this.steps.push(t),this.emit("action",t)}}getFlowText(e=2){return this.steps.slice(e*-1).map(t=>t.message).join("->")}each(e){this.steps.forEach(e)}step(e,t){this.pushStep({meta:t,type:"step",level:"info",message:e,checkoutAt:this.fullName})}fail(e,t){let r=t||e;return this.pushStep({meta:r,type:"fail",level:"danger",message:e,checkoutAt:this.fullName}),r instanceof Error?r:new Error(r)}wrong(e){this.pushStep({meta:e,type:"wrong",level:"danger",message:e,checkoutAt:this.fullName})}checkout(e){let t=new i({name:e,interceptorMessage:this.interceptorMessage});return t.parent=this,{step:t.step.bind(t),fail:t.fail.bind(t),wrong:t.wrong.bind(t),notify:t.notify.bind(t),checkout:t.checkout.bind(t)}}notify(e,t){this.pushStep({meta:t,type:"notify",level:e,message:t,checkoutAt:this.fullName})}};var J=class{constructor({find:s,fetch:e,cache:t,collection:r}){a(this,"dataCache");a(this,"dataCollection");this.dataCollection=new P({waitTime:r?.waitTime||100,query:async n=>await e(n)}),this.dataCache=new k({ttl:t?.ttl||1e3*60*5,maxSize:t?.maxSize||100,key:n=>JSON.stringify(n),pick:async n=>(await this.dataCollection.push(n)).find((l,c)=>s(l,n,c))})}async pick(s){return this.dataCache.get(s)}async list(s){return await Promise.all(s.map(t=>this.dataCache.get(t)))}remove(s){this.dataCache.remove(s)}set(s,e){this.dataCache.set(s,e)}clear(){this.dataCache.clear()}};var C=class{constructor(s){a(this,"isDone",!1);a(this,"isError",!1);a(this,"event",new p);a(this,"response",null);a(this,"params");this.params=s}async run(){return new Promise((s,e)=>{let t=()=>{this.isError?e(this.response):s(this.response)};this.isDone?t():(this.event.on("onload",(r,n)=>{n.off(),t()}),this.event.getEventListenerSize("onload")===1&&this.params.handler().then(r=>{this.response=r}).catch(r=>{this.response=r,this.isError=!0}).finally(()=>{this.isDone=!0,this.event.emit("onload",{})}))})}reset(){this.isDone=!1,this.isError=!1,this.response=null}};var G=class i{constructor(s){a(this,"_images",{});a(this,"_audios",{});a(this,"_onecLoad",new C({handler:async()=>{let s={},e={};for(let t in this.params.images){let r=this.params.images[t],n=typeof r=="string"?i.loadImage(r):r();s[t]=n}for(let t in this.params.audios){let r=this.params.audios[t],n=typeof r=="string"?i.loadAudio(r):r();e[t]=n}this._images=await x.promiseAllWithKeys(s),this._audios=await x.promiseAllWithKeys(e),this.loaded=!0}}));a(this,"loaded",!1);a(this,"params");this.params=s}static async loadImage(s){return new Promise((e,t)=>{let r=new Image;r.onload=()=>e(r),r.onerror=t,r.src=s})}static async loadAudio(s){return new Promise((e,t)=>{let r=new Audio;r.onloadedmetadata=()=>e(r),r.onerror=t,r.src=s})}async load(){await this._onecLoad.run()}getImage(s){return this._images[s]}getAudio(s){return this._audios[s]}async getImagePromise(s){return await this.load(),this._images[s]}async getAudioPromise(s){return await this.load(),this._audios[s]}};var Q=class{constructor(s,e){a(this,"options");a(this,"storage");a(this,"namespaces");a(this,"interceptGet",null);a(this,"interceptSet",null);this.options=e,this.storage=e.storageSystem,this.namespaces=s,e&&(e.storageSystem&&(this.storage=e.storageSystem),e.intercept&&(e.intercept.get&&(this.interceptGet=e.intercept.get.bind(this)),e.intercept.set&&(this.interceptSet=e.intercept.set.bind(this))))}static storageToAsyncStorage(s){return{keys:async()=>Object.keys(s),getItem:async e=>s.getItem(e),setItem:async(e,t)=>s.setItem(e,t),removeItem:async e=>s.removeItem(e)}}toKey(s){return`_power_a_${this.namespaces}/${s.toString()}`}async set(s,e){let t=typeof e!="function"?e:null;if(typeof e=="function"){let r=await this.get(s);t=await e(r)}this.interceptSet&&(t=await this.interceptSet(s,t)),await this.storage.setItem(this.toKey(s),JSON.stringify(t))}async get(s){let e=null,t=this.options,r=!1,n=async()=>null;t&&t.defaultColumns&&t.defaultColumns[s]&&(n=t.defaultColumns[s]);let o=await this.storage.getItem(this.toKey(s));return o==null&&(o=await n(),r=!0),e=r?o:o!=null?JSON.parse(o):null,this.interceptGet&&(e=await this.interceptGet(s,e,{storage:this,isDefault:r,defaultValue:n})),e}async clear(){let s=`_power_a_${this.namespaces}/`,e=await this.storage.keys();for(let t of e)t.length>=s.length&&t.slice(0,s.length)===s&&await this.remove(t.slice(s.length))}async remove(s){await this.storage.removeItem(this.toKey(s))}};var q=class{constructor(s){a(this,"_cache");a(this,"_handler");this._handler=s.handler,this._cache=new E({ttl:s.ttl||1/0})}create(s){let e=g.createUuid();return this._cache.set(e,this._handler(s)),e}remove(s){this._cache.remove(s)}clear(){this._cache.clear()}async get(s,e){if(s){let r=this._cache.get(s);if(r!=null){let n=await r;return this._cache.remove(s),n}}return await this._handler(e)}};var me={flow:g,json:M,text:v,pick:f,calc:ee,array:Z,record:x,detect:K,checker:te,element:se,Log:_,I18n:R,Hook:I,Pool:J,Once:C,Asset:G,Event:p,Cache:k,Timer:D,Ticker:b,Loader:j,Schedule:S,Debounce:$,Reactive:O,Resource:A,Exception:W,CacheLite:E,JobsQueue:N,Breakpoint:z,StyleString:w,PreloadPort:q,Interaction:F,LocalStorage:B,PromiseOverlap:H,QueryCollection:P,WebSocketClient:U,AsyncLocalStorage:Q,ElementListenerGroup:V};export{G as Asset,Q as AsyncLocalStorage,z as Breakpoint,k as Cache,E as CacheLite,$ as Debounce,V as ElementListenerGroup,p as Event,W as Exception,I as Hook,R as I18n,F as Interaction,N as JobsQueue,j as Loader,B as LocalStorage,_ as Log,C as Once,J as Pool,me as PowerHelper,q as PreloadPort,H as PromiseOverlap,P as QueryCollection,O as Reactive,A as Resource,S as Schedule,w as StyleString,b as Ticker,D as Timer,U as WebSocketClient,Z as array,ee as calc,te as checker,K as detect,se as element,g as flow,M as json,f as pick,x as record,v as text};
//# sourceMappingURL=index.js.map

var g={headMatch:(i,s)=>i.slice(0,s.length)===s,lastMatch:(i,s)=>i.slice(s.length*-1)===s,byteLength:i=>{let s=i.length;for(let e=i.length-1;e>=0;e--){let t=i.charCodeAt(e);t>127&&t<=2047?s++:t>2047&&t<=65535&&(s+=2),t>=56320&&t<=57343&&e--}return s},replaceVar:({start:i,end:s,text:e,vars:t,defaultVar:r})=>{let n=!1,a="",o="",l=i[0],p=s[0];for(let u=0;u<e.length;u++){let m=e[u];if(n){if(m===p&&e.slice(u,u+s.length)===s){u+=s.length-1;let se=t?t[o.trim()]?.toString():null;se?a+=se:r&&(a+=r),o="",n=!1;continue}o+=m}else{if(m===l&&(n=e.slice(u,u+i.length)===i,n)){u+=i.length-1;continue}a+=e[u]}}return n?a+i+o:a},format:(i,s,e="-")=>{let t=0,r="";for(let n=0;n<i.length;n++)i[n]==="v"?(r+=s[t]==null?e:s[t],t+=1):r+=i[n];return r},findMatchOrLast:(i,s)=>{for(let e of s)if(i===e)return e;return s[s.length-1]||null}};var S={jpjs:(i,s)=>JSON.parse(JSON.stringify(i,s)),nonStrictJSONParse:i=>{try{return typeof i=="string"?JSON.parse(i):i}catch{return{}}},nonStrictJSONStringify:i=>{try{return JSON.stringify(i)}catch{return"{}"}}};var f={run:i=>i(),sleep:i=>new Promise(s=>{setTimeout(()=>s(null),i)}),randomInt:(i,s)=>Math.floor(Math.random()*(s-i+1)+i),createUuid:()=>{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID();let i=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=(i+Math.random()*16)%16|0;return i=Math.floor(i/16),(s==="x"?e:e&3|8).toString(16)})},createWithTsUuid:()=>`${Date.now()}-${f.createUuid()}`,retry:async i=>{let s=0,e=i.max==null?1:i.max,t=[];for(;e>0;){try{return await i.action(s)}catch(r){i.onFail&&i.onFail(s,r),t.push({count:s,error:r})}s+=1,e-=1,i.interval&&await f.sleep(i.interval)}throw t},asyncWhile:async i=>{let s=!1,e={count:0,doBreak:()=>{s=!0}};for(;await i(e),!s;)e.count+=1},waitFor:i=>new Promise((s,e)=>{let t={done:!1},r=o=>{t.done=!0,s(o)},n=o=>{t.done=!0,e(o)},a=async()=>{try{await i.handler(r,n)}catch(o){n(o)}t.done||setTimeout(a,i.interval)};a()})};var h={ifBad:(i,s)=>{let e=h.getType(i);return["empty","NaN","error"].includes(e)?s:i},ifEmpty:(i,s)=>i??s,getType:i=>{let s=typeof i;return i==null?"empty":Array.isArray(i)?"array":s==="number"&&isNaN(i)?"NaN":i instanceof RegExp?"regexp":i instanceof Promise?"promise":typeof Buffer<"u"&&Buffer.isBuffer(i)?"buffer":i instanceof Error?"error":s},peel:(i,s)=>{let e=s.split(/[.[\]'"]/g).filter(r=>r.trim()!==""),t=i;for(;;){if(e.length===0)return t;if(h.getType(t)!=="object")return null;let r=e.shift();r&&(t=t[r])}},vars:({start:i,end:s,text:e})=>{let t=!1,r=[],n="",a=i[0],o=s[0];for(let l=0;l<e.length;l++){let p=e[l];if(t){if(p===o&&e.slice(l,l+s.length)===s){l+=s.length-1,r.push(n),n="",t=!1;continue}n+=p}else if(p===a&&(t=e.slice(l,l+i.length)===i,t)){l+=i.length-1;continue}}return r}};var Q={toMs:(i,s)=>{let e=0;return i==="s"&&(e=s*1e3),i==="m"&&(e=s*6e4),i==="h"&&(e=s*36e5),i==="d"&&(e=s*864e5),i==="y"&&(e=s*315576e5),Math.floor(e)}};var J={groups:(i,s)=>{let e=[];for(let t=0;t<s.length;t+=i)e.push(s.slice(t,t+i));return e},randomPick:i=>i[Math.floor(Math.random()*i.length)],randomPicks:(i,s)=>{if(s.length<=i)return s.slice();let e=[],t=s.length*100;for(;t>0&&!(e.length>=i);){t-=1;let r=J.randomPick(s);e.includes(r)===!1&&e.push(r)}return e},unique:i=>[...new Set(i)],asyncMap:async(i,s)=>{let e=[];for(let t of i){let r=await s(t);e.push(r)}return e},check:(i,s)=>i.includes(s)?i.filter(e=>e!==s):[...i,s]};var d={setMapValue:(i,s,e)=>{let t=(r,n,a="")=>{let o={},l=r==null?{}:S.jpjs(r),p=n==null?{}:S.jpjs(n);for(let u in l){if(h.getType(l[u])==="object"&&(!!e&&!!e.directReplacePeels&&e.directReplacePeels.includes(`${a}${u}`))===!1){o[u]=t(l[u],p[u],`${a}${u}.`);continue}p[u]===void 0?o[u]=l[u]:o[u]=p[u]}return o};return t(i,s)},createStrictObject:i=>{let s={},e=(t,r)=>new Error(`Strict Object Fail - ${t}: ${r}!`);for(let t in i){let[r,n,a,o]=i[t],l=h.getType(a),p=a;if(l==="empty"){if(n)throw e(t,"is required")}else{if(r===String){if(l!=="string")throw e(t,"not a string");if(n&&p.trim()==="")throw e(t,"no content")}if(r===Number){if(l!=="number"&&l!=="string")throw e(t,"not a number");if(l==="string"&&(p=Number(p.trim())),isNaN(p))throw e(t,"is NaN")}if(r===Boolean){if(l==="string"){if(p=p.trim(),p!=="true"&&p!=="false")throw e(t,"not a boolean");p=p==="true"}if(p!==!0&&p!==!1)throw e(t,"output value not a true or false")}}s[t]=l==="empty"?o:p}return Object.freeze(s)},omit:(i,s)=>{let e={};for(let t in i)s.includes(t)===!1&&(e[t]=i[t]);return e},promiseAllWithKeys:i=>{let s=Object.keys(i),e=Object.values(i);return Promise.all(e).then(t=>t.reduce((r,n,a)=>(r[s[a]]=n,r),{}))},simpleCheckDeepDiff:(i,s)=>{let e=h.getType(i),t=h.getType(s);if(e!==t)return!0;if(e==="object"){let r=Object.keys(i),n=Object.keys(s);if(r.length!==n.length)return!0;for(let a of r)if(d.simpleCheckDeepDiff(i[a],s[a]))return!0;return!1}if(e==="array"){if(i.length!==s.length)return!0;for(let r=0;r<i.length;r++)if(d.simpleCheckDeepDiff(i[r],s[r]))return!0;return!1}return i!==s}};var G=()=>typeof window>"u"?null:window.navigator,E={inAppBrowser:()=>{let i=G();if(i==null)return!1;let s=i.userAgent.toLowerCase(),e=["line/","instagram","fbios","fb_iab","fban","fbav","micromessenger"];for(let t of e)if(s.includes(t))return!0;return!1},inMobile:()=>E.inIOS()||E.inAndroid(),inIOS:()=>{let i=G();return i==null?!1:/iPad|iPhone|iPod/.test(i.userAgent)},inAndroid:()=>{let i=G();return i==null?!1:i.userAgent.toLowerCase().indexOf("android")>-1},inSafari:()=>{let i=G();if(i==null)return!1;let s=i.userAgent,e=!!s.match(/iP(ad|od|hone)/i),t=!!s.match(/Safari/i),r=!s.match(/Chrome|CriOS|OPiOS|mercury|FxiOS|Firefox/i),n=!1;return e?n=!!s.match(/WebKit/i)&&t&&r:typeof window<"u"&&window.safari!==void 0?n=!0:n=t&&r,n}};var q={inputAccept:(i,s,e)=>{if(i==="*/*")return!0;let t=[];if(i.split(",").forEach(r=>{(r===".jpg"||r===".jpeg")&&(t.push(/image\/(jpeg)/i),t.push(/image\/(jpg)/i)),r===".mp3"&&(t.push(/audio\/(mpeg)/i),t.push(/audio\/(mp3)/i)),r.indexOf("/*")!==-1&&t.push(new RegExp(r.replace("*",".+"),"i")),r.startsWith(".")&&t.push(new RegExp(`\\${r}$`,"i")),t.push(new RegExp(r.replace("/","\\/"),"i"))}),e){if(!t.some(n=>n.test(s)||n.test(e)))return!1}else if(!t.some(n=>n.test(s)))return!1;return!0}};var X={importScript:(i,s)=>new Promise((e,t)=>{let r=window.document,n=r.createElement("script"),a=Array.from(window.document.getElementsByTagName("script"));for(let o of a)if(o.src===i)return e(null);n.src=i,s?.appendBefore&&s.appendBefore(n),n.onload=e,n.onerror=t,r.body.appendChild(n)}),createAndAppend:(i,s,e)=>{let t=window.document.createElement(i);return s(t),e?e.appendChild(t):window.document.body.appendChild(t),t},importCss:(i,s)=>new Promise((e,t)=>{let r=window.document,n=r.createElement("link"),a=Array.from(window.document.getElementsByTagName("link"));for(let o of a)if(o.href===i)return e(null);n.rel="stylesheet",n.href=i,s?.appendBefore&&s.appendBefore(n),n.onload=e,n.onerror=t,r.body.appendChild(n)})};var Z=class{constructor(s,e,t){this.id=Date.now().toString()+Math.floor(Math.random()*1e6);this.state={};this.manager=s,this.event=e,this.callback=t}invoke(s){this.callback(s,{id:this.id,off:()=>this.off(),state:this.state})}off(){this.manager.off(this.event,this.id)}},c=class{constructor(){this.listeners=new Map}getEventListenerSize(s){let e=this.listeners.get(s);return e?e.length:0}emit(s,e){let t=this.listeners.get(s);if(t)for(let n of t)n.invoke(e);let r=this.listeners.get("*");if(r)for(let n of r)n.invoke({data:e,event:s})}off(s,e){let t=s,r=this.listeners.get(t);r&&this.listeners.set(t,r.filter(n=>n.id!==e))}on(s,e){let t=s,r=new Z(this,t,e);return this.listeners.has(t)===!1&&this.listeners.set(t,[]),this.listeners.get(t).push(r),r}};var ie={default:"",red:"\x1B[31m",blue:"\x1B[34m",cyan:"\x1B[36m",black:"\x1B[30m",white:"\x1B[37m",green:"\x1B[32m",yellow:"\x1B[33m"},C=class extends c{constructor(e,t){super();this.step=0;this.isSilence=!1;this.defaultLogType="normal";this.name=e,t&&(t.silence!=null&&this.silence(t.silence),t.defaultLogType!=null&&(this.defaultLogType=t.defaultLogType))}getNow(){return new Date().toISOString().split(/T|\./).slice(0,2).join(" ")}toPrintString(e,t,r){return`[${e}][${this.name}][${t}] ${this.step}: ${r}`}silence(e=!0){this.isSilence=e}print(e,t={}){this.step+=1;let r=this.getNow(),n=t.color||"default",a=t.logType||this.defaultLogType,o=this.toPrintString(r,a,e),l={time:r,name:this.name,step:this.step,data:e,color:n,message:o,logType:a,silence:this.isSilence};return this.emit("print",l),this.isSilence===!1&&(n==="default"?console.log(o):typeof window>"u"?console.log(`${ie[n]}${o}\x1B[0m`):console.log(`%c ${o}`,`color: ${n}`)),l}};var{replaceVar:ne}=g,M=class extends c{constructor(s){super(),this.params=s,this.nowLocale=s.def}get(s,e,...t){let r=e;r.slice(0,2)==="##"?r=r.slice(2).trim():r=this.params.locales?.[s]?.[e]||e;let n=ne({start:"{",end:"}",text:r,vars:t[0]||{}});return this.emit("get",{key:e,text:r,locale:s,output:n}),n}export(s){return(e,...t)=>this.get(s,e,...t)}t(s,...e){return this.get(this.nowLocale,s,...e)}setLocale(s){this.nowLocale=s}getLocale(){return this.nowLocale}key(s,...e){return{get:t=>this.get(t,s,...e)}}};var Y=class{constructor(s,e,t){this.id=Date.now().toString()+Math.floor(Math.random()*1e6);this.state={};this.isAfter=!1;this.manager=s,this.channel=e,this.callback=t}async invoke(s){await this.callback(s,{id:this.id,off:()=>this.off(),state:this.state})}off(){this.manager.detach(this.channel,this.id)}},K=class{constructor(){this.listeners=new Map}async notify(s,e){let t=this.listeners.get(s);if(t){for(let r of t.filter(n=>n.isAfter===!1))await r.invoke(e);for(let r of t.filter(n=>n.isAfter))await r.invoke(e)}}detach(s,e){let t=s,r=this.listeners.get(t);r&&this.listeners.set(t,r.filter(n=>n.id!==e))}attach(s,e){let t=s,r=new Y(this,t,e);return this.listeners.has(t)===!1&&this.listeners.set(t,[]),this.listeners.get(t).push(r),r}attachAfter(s,e){let t=this.attach(s,e);return t.isAfter=!0,t}};var ee=class{constructor(s,e,t){this.createdAt=Date.now();this.data=s,this.index=e,this.ttl=t}isExpired(){return this.createdAt+this.ttl<Date.now()}},y=class extends c{constructor(e){super();this.event=new c;this.index=0;this.items=new Map;this.key=e.key,this.pick=e.pick,this.maxSize=e.maxSize||1/0,this.ttl=e.ttl==null?1/0:e.ttl}refresh(){if(this.ttl!==1/0&&this.removeExpired(),this.maxSize!==1/0&&this.items.size>this.maxSize){let e=this.items.size-this.maxSize,t=[...this.items.entries()].sort((r,n)=>r[1].index>n[1].index?1:-1).slice(0,e);for(let r of t)this.removeByKey(r[0])}}keys(){return Array.from(this.items.keys())}size(){return this.items.size}clear(){let e=this.keys();for(let t of e)this.removeByKey(t)}remove(e){let t=this.key(e);this.removeByKey(t)}removeExpired(){for(let[e,t]of this.items)t.isExpired()&&this.removeByKey(e)}removeByKey(e){let t=this.items.get(e);t&&(this.emit("remove",{data:t.data}),this.items.delete(e))}set(e,t){let r=this.key(e);this.setByKey(r,t)}setByKey(e,t){this.removeByKey(e),this.index+=1,this.items.set(e,new ee(t,this.index,this.ttl)),this.refresh()}get(e){return this.refresh(),new Promise((t,r)=>{let n=this.key(e),a=this.items.get(n);if(a&&a.isExpired()===!1)return t(a.data);let o=`${n}-onload`,l=`${n}-error`,[p,u]=[this.event.on(o,m=>{p.off(),u.off(),t(m)}),this.event.on(l,m=>{p.off(),u.off(),r(m)})];this.event.getEventListenerSize(o)===1&&this.pick(e,{key:n}).then(m=>{this.event.emit(o,m),this.setByKey(n,m)}).catch(m=>{this.event.emit(l,m)})})}};var x=class extends c{constructor(e,t){super();this.isStop=!1;this.delta=0;this.previousTime=Date.now();this.int=setInterval(()=>this.run(),e),t&&t.autoPlay===!1&&this.stop()}run(){if(this.isStop===!1){let e=Date.now();this.delta+=1,this.emit("next",{delta:this.delta,timeGap:e-this.previousTime}),this.previousTime=e}}stop(){this.isStop=!0}play(){this.isStop=!1,this.previousTime=Date.now()}close(){clearInterval(this.int)}};var L=class extends x{constructor(){super(1,{autoPlay:!1});this.nowTime=0;this.minTime=0;this.maxTime=999999999999;this.positive=!0;this.on("next",({timeGap:e})=>{this.positive?this.nowTime+=e:this.nowTime-=e,this.nowTime<=this.minTime&&(this.nowTime=this.minTime),this.nowTime>=this.maxTime&&(this.nowTime=this.maxTime)})}setPositive(e){return this.positive=e,this}setMinTime(e){this.minTime=e}setMaxTime(e){this.maxTime=e}getTime(){return this.nowTime}setTime(e){return this.nowTime=e,this}addTime(e){return this.nowTime+=e,this}subtractTime(e){return this.nowTime-=e,this}getHours(){return this.nowTime/1e3/60/60}getMinutes(){return this.nowTime/1e3/60%60}getSeconds(){return this.nowTime/1e3%60}getMicroseconds(){return this.nowTime%1e3}getTimeString(e="hh:mm:ss.ff"){let t=Math.floor(this.getHours()).toString().padStart(2,"0"),r=Math.floor(this.getMinutes()).toString().padStart(2,"0"),n=Math.floor(this.getSeconds()).toString().padStart(2,"0"),a=Math.floor(this.getMicroseconds()/10).toString().padStart(2,"0");return e.replace("hh",t).replace("mm",r).replace("ss",n).replace("ff",a)}};var P=(i,s)=>{throw new Error(`PowerHelper (X_X) => ${i} -> ${s}`)};var _=class extends c{constructor(e="no_name"){super();this.items=[];this.status={isDone:!1,isCalled:!1,isLoading:!1,complete:0,fail:null};this.name=e}get size(){return this.items.length}get complete(){return this.status.complete}get done(){return this.status.isDone}get fail(){return this.status.fail}get called(){return this.status.isCalled}get loading(){return this.status.isLoading}clear(){this.items=[],this.emit("clear",{})}push(e,t){this.items.find(n=>n.name===e)&&P("push",`Loader ${e} push name ${e} already exists.`),this.items.push({name:e,handler:t})}reset(){if(this.status.isDone===!1)throw new Error(`Loader ${this.name} call "reset" must called start.`);return Object.assign(this.status,{isDone:!1,isCalled:!1,isLoading:!1,complete:0,fail:null}),this}start(e){return this.status.isCalled&&P("start",`Loader ${this.name} Already Called.`),this.status.isCalled=!0,this.status.isLoading=!0,this.emit("call",{}),new Promise((t,r)=>{let n=this.items.map(({name:a,handler:o})=>async()=>{try{let l=await o(e);return this.status.complete+=1,this.emit("complete",{name:a,result:l,loaderName:this.name}),{name:a,result:l}}catch(l){throw{isPowerHelperLoader:!0,loaderName:this.name,name:a,error:l}}});Promise.all(n.map(a=>a())).then(a=>{this.status.isDone=!0,this.status.isLoading=!1,this.emit("done",{}),t(a)}).catch(a=>{this.status.isDone=!0,this.status.isLoading=!1,this.status.fail=a,this.emit("fail",{error:a}),r(a)})})}};function ae(i){return i.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`)}var T=class{constructor(){this.styles={}}set(s,e,t){let r=e??t;r&&(this.styles[s]=r)}get(s){return this.styles[s]}remove(s){this.styles[s]&&delete this.styles[s]}assign(s){for(let[e,t]of Object.entries(this.styles))s.style[e]=t}join(s=";"){let e=[];for(let[t,r]of Object.entries(this.styles))e.push(`${ae(t)}:${r}`);return e.join(s)}};var R=class extends c{constructor(e){super();this.objectUrls=[];this.params=e}createObjectUrl(e){let t=URL.createObjectURL(e);return this.objectUrls.push(t),t}get(e,...t){return this.url(this.params.items?.[e]?.(t[0])||"")}url(e){let t="",r=!1;if(typeof e=="string"){let n=e.trim(),a=["http","file","data:","//"];for(let o of a)if(g.headMatch(n,o)){t=n;break}}else typeof File<"u"&&e instanceof File?(t=this.createObjectUrl(e),r=!0):typeof Blob<"u"&&e instanceof Blob?(t=this.createObjectUrl(e),r=!0):typeof MediaSource<"u"&&e instanceof MediaSource&&(t=this.createObjectUrl(e),r=!0);return t.trim()===""&&(t=typeof e=="string"?this.params.def(e):""),this.emit("fetch",{url:t,source:e,isObjectUrl:r}),t}release(){this.objectUrls.forEach(e=>URL.revokeObjectURL(e)),this.objectUrls=[]}backgroundStyle(e,t="basic"){let r=new T;return r.set("backgroundImage",`url(${this.url(e)})`),t==="cover"&&(r.set("backgroundSize","cover"),r.set("backgroundRepeat","no-repeat"),r.set("backgroundPosition","center")),r.join()}};var v=class extends c{constructor(){super(...arguments);this.int=setInterval(()=>this._run(),100);this.isStop=!1;this.lastTime=Date.now();this.processes=[]}_run(){if(this.isStop)return null;let e=Date.now(),t=e-this.lastTime;this.lastTime=e;for(let r of this.processes)r.runningTime||(r.now+=t,r.now>=r.sec&&(r.now=0,r.runningTime=Date.now(),r.executedCount+=1,r.handler().then(()=>{r.runningTime=null}).catch(n=>{r.runningTime=null,this.emit("processFail",{processName:r.name,error:n})})))}run(e){let t=this.processes.find(r=>r.name===e);t!=null&&t.runningTime==null&&(t.now=t.sec,this._run())}add(e,t,r){this.processes.find(n=>n.name===e)&&P("add",`Name ${e} already exists.`),this.processes.push({sec:t,now:0,name:e,executedCount:0,runningTime:null,handler:r})}has(e){return!!this.processes.find(t=>t.name===e)}remove(e){this.processes.find(t=>t.name===e)==null&&P("add",`Name ${e} not found.`),this.processes=this.processes.filter(t=>t.name!==e)}info(){return this.processes.map(e=>({name:e.name,runningTime:e.runningTime,executedCount:e.executedCount}))}stop(){this.isStop=!0}play(){this.isStop=!1}close(){clearInterval(this.int)}};var D=class extends c{constructor(e){super();this.oldKey=null;this.schedule=new v;this.installed=!1;this.nextTicks=[];this.params=e}isActive(){return this.installed}close(){this.schedule.close()}nextTick(e){this.nextTicks.push(e)}async from(e){this.oldKey=null,this.state=e,this.installed=!0;let t=this.params.schedule!=null?this.params.schedule:100;return await this.dispatch(),this.schedule.has("reactive")===!1&&this.schedule.add("reactive",t,async()=>{await this.dispatch()}),this}async dispatch(){let e=await this.params.observable(this.state);if(e!==this.oldKey&&await this.trigger(e),this.nextTicks.length>=1){for(let t of this.nextTicks)t(this.state);this.nextTicks=[]}}async trigger(e){let t={state:this.state,newKey:e,oldKey:this.oldKey};this.emit("actionBefore",t),await this.params.action({...t,close:()=>this.close()}),this.emit("actionAfter",t),this.oldKey=e}};var te=class extends c{constructor(e){super();this.isDone=!1;this.values=[];this.params=e,this.duration=e.delay==null?-1:e.delay,this.totalDuration=e.totalDuration==null?-1:e.totalDuration,this.loop()}loop(){if(this.isDone)return null;if(this.duration===0)return this.trigger();if(this.totalDuration===0)return this.trigger();if(this.params.maxValueLength!=null&&this.params.maxValueLength<=this.values.length)return this.trigger();this.duration-=1,this.totalDuration-=1,setTimeout(()=>this.loop(),1)}input(e){this.values.push(e),this.duration=this.params.delay==null?-1:this.params.delay}trigger(){this.isDone===!1&&(this.close(),this.emit("trigger",{values:this.values}))}close(){this.isDone===!1&&(this.isDone=!0,this.emit("close",{}))}},I=class extends c{constructor(e){super();this.unit=null;this.params=e}input(e){this.unit==null&&(this.unit=new te(this.params),this.unit.on("trigger",({values:t})=>this.emit("trigger",{values:t})),this.unit.on("close",()=>this.close())),this.unit.input(e),this.emit("input",{value:e})}trigger(){this.unit?this.unit.trigger():this.emit("trigger",{values:[]})}close(){this.unit&&(this.unit.close(),this.unit=null)}};var j=class extends c{constructor(e){super();this.jobs=[];this.closed=!1;this.isStop=!1;this.runningCount=0;this.params=e,this.params.autoPlay===!1&&(this.isStop=!0)}get size(){return this.jobs.length+this.runningCount}run(){if(this.isStop||this.closed||this.params.concurrentExecutions&&this.runningCount>=this.params.concurrentExecutions)return null;let e=this.jobs.shift();e&&(this.runningCount+=1,e.handler().catch(t=>{this.emit("error",{name:e?.name||"",error:t})}).finally(()=>{this.less(),this.run()}))}less(){this.runningCount-=1,this.runningCount<=0&&(this.runningCount=0),this.size===0&&this.emit("allDone",{})}get isStoped(){return this.isStop}push(e,t){this.closed===!1&&(this.jobs.push({name:e,handler:t}),this.run())}stop(){this.isStop=!0}play(){this.isStop&&(this.isStop=!1,this.run())}pushAndWait(e,t){return new Promise((r,n)=>{if(this.closed)return r(null);this.jobs.push({name:e,handler:async()=>{try{await t(),r(null)}catch(a){n(a)}}}),this.run()})}unshift(e,t){this.closed===!1&&(this.jobs.unshift({name:e,handler:t}),this.run())}clear(){this.jobs=[]}close(){this.clear(),this.closed=!0}};var O=class{constructor(s,e){this.interceptGet=null;this.interceptSet=null;this.options=e,this.storage=typeof window>"u"?null:window.localStorage,this.namespaces=s,e&&(e.storageSystem&&(this.storage=e.storageSystem),e.intercept&&(e.intercept.get&&(this.interceptGet=e.intercept.get.bind(this)),e.intercept.set&&(this.interceptSet=e.intercept.set.bind(this))))}toKey(s){return`_power_${this.namespaces}/${s.toString()}`}set(s,e){let t=typeof e=="function"?e(this.get(s)):e;this.interceptSet&&(t=this.interceptSet(s,t)),this.storage.setItem(this.toKey(s),JSON.stringify(t))}get(s){let e=null,t=this.options,r=!1,n=()=>null;t&&t.defaultColumns&&t.defaultColumns[s]&&(n=t.defaultColumns[s]);let a=this.storage.getItem(this.toKey(s));return a==null&&(a=n(),r=!0),e=r?a:a!=null?JSON.parse(a):null,this.interceptGet&&(e=this.interceptGet(s,e,{storage:this,isDefault:r,defaultValue:n})),e}clear(){let s=`_power_${this.namespaces}/`,e=this.storage.keys?this.storage.keys():Object.keys(this.storage);for(let t of e)t.length>=s.length&&t.slice(0,s.length)===s&&this.remove(t.slice(s.length))}remove(s){this.storage.removeItem(this.toKey(s))}};var k=class{constructor(s){this.timeout=null;this.collection=[];this.params=s}push(s){return new Promise((e,t)=>{this.collection.push({data:s,resolve:e,reject:t}),this.timeout==null&&(this.timeout=setTimeout(async()=>{let r=this.collection.slice();this.timeout=null,this.collection=[];try{let n=await this.params.query(r.map(a=>a.data));r.forEach(a=>a.resolve(n))}catch(n){r.forEach(a=>a.reject(n))}},this.params.waitTime))})}};var A=class{constructor(s){this.elements=[];this.listeners=new Map;s&&this.elements.push(s)}observe(s){this.elements.push(s);for(let e of this.listeners.values())s.addEventListener(e.name,e.callback,e.options)}unObserve(s){if(this.elements.find(e=>e===s)!=null){this.elements=this.elements.filter(e=>e!==s);for(let e of this.listeners.values())s.removeEventListener(e.name,e.callback)}}off(s){let e=this.listeners.get(s);if(e){this.listeners.delete(s);for(let t of this.elements)t.removeEventListener(e.name,e.callback)}}add(s,e,t){let r=f.createUuid(),n={name:s,options:t,callback:e};return this.listeners.set(r,n),this.elements.forEach(a=>a.addEventListener(n.name,n.callback,t)),{id:r,off:()=>this.off(r)}}clear(){for(let s of this.listeners.keys())this.off(s)}clearElements(){for(let s of this.listeners.values())for(let e of this.elements)e.removeEventListener(s.name,s.callback);this.elements=[]}};var $=class extends c{constructor(e){super();this.isManuallyClosed=!1;this.params=e}fail(e,t){this.emit("$error",{from:e,error:t})}get connected(){return!!this._websocket}createWebsocket(e){this.connected&&console.warn(`Websocket ${e} already connected.`);let t=!1,r=this.params.system?this.params.system:WebSocket;return new Promise((n,a)=>{this._websocket=new r(e,this.params.protocol),this._websocket.onopen=()=>{t=!0,this.emit("$open",{}),n(null)},this._websocket.onerror=o=>{t===!1?a(o):this.fail("unknown",o)},this._websocket.onmessage=async o=>{try{await this.params.onMessage(o)}catch(l){this.fail("message",l)}},this._websocket.onclose=()=>{let o={isManuallyClosed:this.isManuallyClosed};this._websocket=void 0,this.emit("$close",o),this.isManuallyClosed=!1}})}getStatus(){if(this.connected===!1)return"wait";if(this._websocket?.readyState===0)return"connecting";if(this._websocket?.readyState===1)return"open";if(this._websocket?.readyState===2)return"closeing";if(this._websocket?.readyState===3)return"closed"}async send(e,t){try{let r=await this.params.sendHandler(e,t);this.connected?this._websocket?.send(r):console.warn(`Socket not connected, from send ${e}.`)}catch(r){this.fail("send",r)}}async connect(){let e=await this.params.url();return await this.createWebsocket(e)}disconnect(){this.connected?(this.isManuallyClosed=!0,this._websocket?.close()):console.warn("Socket not connected, from disconnect.")}};var N=class{constructor(s,e={}){this.processes=[];this.pick=s,this.options=e}run(s){let e={data:null,closed:!1,reject:null,resolve:null,isError:!1},t=(r,n)=>{if(e.data=r,e.closed=!0,e.isError=n,this.processes.filter(o=>!o.closed).length===0){let o;this.pick==="first"?o=this.processes[0]:o=this.processes[this.processes.length-1];for(let l of this.processes)o.isError?l.reject(o.data):l.resolve(o.data);this.processes=[]}};return this.processes.push(e),new Promise((r,n)=>{e.reject=n,e.resolve=r,setTimeout(()=>{s().then(a=>t(a,!1)).catch(a=>t(a,!0))},this.options.delay||10)})}};var b=class{constructor(s){this.lastUpdate=Date.now();this.keyMap=new Map;this.params=s}gc(){let s=Date.now();if(s>this.lastUpdate+this.params.ttl){for(let[e,t]of this.keyMap.entries())t.time+this.params.ttl<s&&this.keyMap.delete(e);this.lastUpdate=s}}get size(){return this.keyMap.size}clear(){this.keyMap.clear()}get(s){return this.gc(),this.keyMap.get(s)?.data}set(s,e){let t={key:s,value:e},r=this.params.intercept?.set?this.params.intercept?.set(t):t;if(this.gc(),this.keyMap.set(r.key,{data:r.value,time:Date.now()}),this.params.maxSize&&this.keyMap.size>this.params.maxSize){let n=Array.from(this.keyMap.keys())[0];n!=null&&this.keyMap.delete(n)}return r.value}has(s){return this.gc(),this.keyMap.has(s)}remove(s){this.gc(),this.keyMap.has(s)&&this.keyMap.delete(s)}keys(){return this.gc(),[...this.keyMap.keys()]}values(){return this.gc(),[...this.keyMap.values()].map(s=>s.data)}};var B=class{constructor(s){this.params=s}static get bootstrapBreakpoints(){return{xs:{min:1/0*-1,max:575},sm:{min:576,max:767},md:{min:768,max:991},lg:{min:992,max:1119},xl:{min:1200,max:1/0}}}static get vuetifyBreakpoints(){return{xs:{min:1/0*-1,max:599},sm:{min:600,max:959},md:{min:960,max:1263},lg:{min:1264,max:1903},xl:{min:1904,max:1/0}}}matchs(s=this.params.defCheckValue()){let e=[];for(let t in this.params.points){let r=t,{min:n,max:a}=this.params.points[r];s>=n&&s<=a&&e.push(`${r}-only`),s>=n&&e.push(`${r}-and-up`),s<=a&&e.push(`${r}-and-down`)}return e}is(s=this.params.defCheckValue()){let e=["xl","lg","md","sm","xs"],t=this.matchs(s);for(let r of e)if(t.includes(`${r}-only`))return r;return"xs"}in(s,e=this.params.defCheckValue()){return this.matchs(e).includes(s)}};var V=class i extends c{constructor(e,t){super();this.parent=null;this.options={defaultError:()=>"Error!",parseMessage:e=>e};this.serviceName=e,t&&Object.assign(this.options,t)}static get basicMessageParser(){return e=>{if(typeof e=="string")return e;if(e.name==="AxiosError"){if(e.response?.data&&typeof e.response?.data=="string")return e.response.data;if(e.response?.data?.message&&typeof e.response?.data?.message=="string")return e.response?.data?.message;if(e.response?.data?.error&&typeof e.response?.data?.error=="string")return e.response?.data?.error}let t=e.message;return t&&typeof t=="string"?t:null}}_setParent(e){this.parent=e}_getParents(){return this.parent==null?[]:[this.parent,...this.parent._getParents()]}get fullName(){return this.parent==null?this.serviceName:`${this.parent.fullName}/${this.serviceName}`}parseMessage(e){let t=this.options.parseMessage(e);return t||this.options.defaultError()}create(e){let t=this.parseMessage(e),r={error:e,message:t};return this._getParents().concat([this]).forEach(n=>n.emit("fail",r)),new Error(`${this.fullName}: ${t}`)}checkout(e){let t=new i(e,this.options);return t._setParent(this),t}};var U=class i extends c{constructor({name:e,interceptorMessage:t,stepMaxSize:r}){super();this.steps=[];this.stepMaxSize=100;this.name=e,this.interceptorMessage=t||(n=>n),this.stepMaxSize=r||100}get fullName(){return this.parent?`${this.parent.fullName}/${this.name}`:this.name}pushStep(e){if(this.parent)this.parent.pushStep(e);else{this.steps.length>=this.stepMaxSize&&this.steps.shift();let t={...e,message:this.interceptorMessage(e.message),createdAt:Date.now()};this.steps.push(t),this.emit("action",t)}}getFlowText(e=2){return this.steps.slice(e*-1).map(t=>t.message).join("->")}each(e){this.steps.forEach(e)}step(e,t){this.pushStep({meta:t,type:"step",level:"info",message:e,checkoutAt:this.fullName})}fail(e,t){let r=t||e;return this.pushStep({meta:r,type:"fail",level:"danger",message:e,checkoutAt:this.fullName}),r instanceof Error?r:new Error(r)}wrong(e){this.pushStep({meta:e,type:"wrong",level:"danger",message:e,checkoutAt:this.fullName})}checkout(e){let t=new i({name:e,interceptorMessage:this.interceptorMessage});return t.parent=this,{step:t.step.bind(t),fail:t.fail.bind(t),wrong:t.wrong.bind(t),notify:t.notify.bind(t),checkout:t.checkout.bind(t)}}notify(e,t){this.pushStep({meta:t,type:"notify",level:e,message:t,checkoutAt:this.fullName})}};var H=class{constructor({find:s,fetch:e,cache:t,collection:r}){this.dataCollection=new k({waitTime:r?.waitTime||100,query:async n=>await e(n)}),this.dataCache=new y({ttl:t?.ttl||1e3*60*5,maxSize:t?.maxSize||100,key:n=>JSON.stringify(n),pick:async n=>(await this.dataCollection.push(n)).find((o,l)=>s(o,n,l))})}async pick(s){return this.dataCache.get(s)}async list(s){return await Promise.all(s.map(t=>this.dataCache.get(t)))}remove(s){this.dataCache.remove(s)}set(s,e){this.dataCache.set(s,e)}clear(){this.dataCache.clear()}};var w=class{constructor(s){this.isDone=!1;this.isError=!1;this.event=new c;this.response=null;this.params=s}async run(){return new Promise((s,e)=>{let t=()=>{this.isError?e(this.response):s(this.response)};this.isDone?t():(this.event.on("onload",(r,n)=>{n.off(),t()}),this.event.getEventListenerSize("onload")===1&&this.params.handler().then(r=>{this.response=r}).catch(r=>{this.response=r,this.isError=!0}).finally(()=>{this.isDone=!0,this.event.emit("onload",{})}))})}reset(){this.isDone=!1,this.isError=!1,this.response=null}};var z=class i{constructor(s){this._images={};this._audios={};this._onecLoad=new w({handler:async()=>{let s={},e={};for(let t in this.params.images){let r=this.params.images[t],n=typeof r=="string"?i.loadImage(r):r();s[t]=n}for(let t in this.params.audios){let r=this.params.audios[t],n=typeof r=="string"?i.loadAudio(r):r();e[t]=n}this._images=await d.promiseAllWithKeys(s),this._audios=await d.promiseAllWithKeys(e),this.loaded=!0}});this.loaded=!1;this.params=s}static async loadImage(s){return new Promise((e,t)=>{let r=new Image;r.onload=()=>e(r),r.onerror=t,r.src=s})}static async loadAudio(s){return new Promise((e,t)=>{let r=new Audio;r.onloadedmetadata=()=>e(r),r.onerror=t,r.src=s})}async load(){await this._onecLoad.run()}getImage(s){return this._images[s]}getAudio(s){return this._audios[s]}async getImagePromise(s){return await this.load(),this._images[s]}async getAudioPromise(s){return await this.load(),this._audios[s]}};var W=class{constructor(s,e){this.interceptGet=null;this.interceptSet=null;this.options=e,this.storage=e.storageSystem,this.namespaces=s,e&&(e.storageSystem&&(this.storage=e.storageSystem),e.intercept&&(e.intercept.get&&(this.interceptGet=e.intercept.get.bind(this)),e.intercept.set&&(this.interceptSet=e.intercept.set.bind(this))))}static storageToAsyncStorage(s){return{keys:async()=>Object.keys(s),getItem:async e=>s.getItem(e),setItem:async(e,t)=>s.setItem(e,t),removeItem:async e=>s.removeItem(e)}}toKey(s){return`_power_a_${this.namespaces}/${s.toString()}`}async set(s,e){let t=typeof e!="function"?e:null;if(typeof e=="function"){let r=await this.get(s);t=await e(r)}this.interceptSet&&(t=await this.interceptSet(s,t)),await this.storage.setItem(this.toKey(s),JSON.stringify(t))}async get(s){let e=null,t=this.options,r=!1,n=async()=>null;t&&t.defaultColumns&&t.defaultColumns[s]&&(n=t.defaultColumns[s]);let a=await this.storage.getItem(this.toKey(s));return a==null&&(a=await n(),r=!0),e=r?a:a!=null?JSON.parse(a):null,this.interceptGet&&(e=await this.interceptGet(s,e,{storage:this,isDefault:r,defaultValue:n})),e}async clear(){let s=`_power_a_${this.namespaces}/`,e=await this.storage.keys();for(let t of e)t.length>=s.length&&t.slice(0,s.length)===s&&await this.remove(t.slice(s.length))}async remove(s){await this.storage.removeItem(this.toKey(s))}};var F=class{constructor(s){this._handler=s.handler,this._cache=new b({ttl:s.ttl||1/0})}create(s){let e=f.createUuid();return this._cache.set(e,this._handler(s)),e}remove(s){this._cache.remove(s)}clear(){this._cache.clear()}async get(s,e){if(s){let r=this._cache.get(s);if(r!=null){let n=await r;return this._cache.remove(s),n}}return await this._handler(e)}};var oe={flow:f,json:S,text:g,pick:h,calc:Q,array:J,record:d,detect:E,checker:q,element:X,Log:C,I18n:M,Hook:K,Pool:H,Once:w,Asset:z,Event:c,Cache:y,Timer:L,Ticker:x,Loader:_,Schedule:v,Debounce:I,Reactive:D,Resource:R,Exception:V,CacheLite:b,JobsQueue:j,Breakpoint:B,StyleString:T,PreloadPort:F,Interaction:U,LocalStorage:O,PromiseOverlap:N,QueryCollection:k,WebSocketClient:$,AsyncLocalStorage:W,ElementListenerGroup:A};export{z as Asset,W as AsyncLocalStorage,B as Breakpoint,y as Cache,b as CacheLite,I as Debounce,A as ElementListenerGroup,c as Event,V as Exception,K as Hook,M as I18n,U as Interaction,j as JobsQueue,_ as Loader,O as LocalStorage,C as Log,w as Once,H as Pool,oe as PowerHelper,F as PreloadPort,N as PromiseOverlap,k as QueryCollection,D as Reactive,R as Resource,v as Schedule,T as StyleString,x as Ticker,L as Timer,$ as WebSocketClient,J as array,Q as calc,q as checker,E as detect,X as element,f as flow,S as json,h as pick,d as record,g as text};
//# sourceMappingURL=index.js.map
